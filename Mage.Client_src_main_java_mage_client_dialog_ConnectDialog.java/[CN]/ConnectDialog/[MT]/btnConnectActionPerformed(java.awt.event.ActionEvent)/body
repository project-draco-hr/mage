{
  if (txtUserName.getText().isEmpty()) {
    JOptionPane.showMessageDialog(rootPane,"Please provide a user name");
    return;
  }
  if (txtServer.getText().trim().isEmpty()) {
    JOptionPane.showMessageDialog(rootPane,"Please provide a server address");
    return;
  }
  if (txtPort.getText().trim().isEmpty()) {
    JOptionPane.showMessageDialog(rootPane,"Please provide a port number");
    return;
  }
  if (Integer.valueOf(txtPort.getText()) < 1 || Integer.valueOf(txtPort.getText()) > 65535) {
    JOptionPane.showMessageDialog(rootPane,"Invalid port number");
    txtPort.setText(MageFrame.getPreferences().get("serverPort",Integer.toString(Config.port)));
    return;
  }
  try {
    setCursor(new Cursor(Cursor.WAIT_CURSOR));
    Connection connection=new Connection();
    connection.setHost(this.txtServer.getText());
    connection.setPort(Integer.valueOf(this.txtPort.getText()));
    connection.setUsername(this.txtUserName.getText());
    connection.setProxyType((ProxyType)this.cbProxyType.getSelectedItem());
    connection.setProxyHost(this.txtProxyServer.getText());
    connection.setProxyPort(Integer.valueOf(this.txtProxyPort.getText()));
    connection.setProxyUsername(this.txtProxyUserName.getText());
    connection.setProxyPassword(this.txtProxyPassword.getText());
    if (MageFrame.connect(connection)) {
      this.saveSettings();
      this.setVisible(false);
    }
  }
  finally {
    setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
  }
}
