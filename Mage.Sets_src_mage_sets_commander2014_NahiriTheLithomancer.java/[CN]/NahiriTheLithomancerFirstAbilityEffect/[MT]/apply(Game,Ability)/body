{
  Player controller=game.getPlayer(source.getControllerId());
  if (controller != null) {
    Token token=new NahiriTheLithomancerKorSoldierToken();
    if (token.putOntoBattlefield(1,game,source.getSourceId(),source.getControllerId())) {
      Permanent tokenPermanent=game.getPermanent(token.getLastAddedToken());
      if (tokenPermanent != null) {
        Target target=new TargetControlledPermanent(0,1,filter,true);
        if (target.canChoose(source.getSourceId(),controller.getId(),game) && controller.chooseUse(outcome,"Attach an Equipment you control to the created Token?",source,game)) {
          if (target.choose(Outcome.Neutral,source.getControllerId(),source.getSourceId(),game)) {
            Permanent equipmentPermanent=game.getPermanent(target.getFirstTarget());
            if (equipmentPermanent != null) {
              Permanent attachedTo=game.getPermanent(equipmentPermanent.getAttachedTo());
              if (attachedTo != null) {
                attachedTo.removeAttachment(equipmentPermanent.getId(),game);
              }
              tokenPermanent.addAttachment(equipmentPermanent.getId(),game);
            }
          }
        }
      }
    }
    return true;
  }
  return false;
}
