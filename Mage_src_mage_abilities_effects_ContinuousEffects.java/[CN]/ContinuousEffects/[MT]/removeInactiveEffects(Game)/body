{
  for (Iterator<ContinuousEffect> i=effects.keySet().iterator(); i.hasNext(); ) {
    ContinuousEffect entry=i.next();
    if (entry.getDuration() == Duration.WhileOnBattlefield) {
      Permanent permanent=game.getPermanent(effects.get(entry).getSourceId());
      if (permanent == null || !permanent.isPhasedIn())       i.remove();
    }
    if (entry.getDuration() == Duration.OneUse) {
      if (entry instanceof ReplacementEffect) {
        if (((ReplacementEffect)entry).isUsed())         i.remove();
      }
    }
  }
}
