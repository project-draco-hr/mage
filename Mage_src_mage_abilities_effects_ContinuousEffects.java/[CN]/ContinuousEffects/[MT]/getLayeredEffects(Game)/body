{
  List<ContinuousEffect> layerEffects=new ArrayList<ContinuousEffect>(layeredEffects);
  for (  Card card : game.getCards()) {
    Zone zone=game.getZone(card.getId());
    if (zone == Zone.HAND || zone == Zone.GRAVEYARD) {
      for (      Ability ability : card.getAbilities().getStaticAbilities(zone)) {
        for (        Effect effect : ability.getEffects(game,EffectType.CONTINUOUS)) {
          layerEffects.add((ContinuousEffect)effect);
          abilityMap.put(effect.getId(),ability);
        }
      }
    }
  }
  for (  Permanent permanent : game.getBattlefield().getAllPermanents()) {
    for (    Ability ability : permanent.getAbilities().getStaticAbilities(Zone.BATTLEFIELD)) {
      for (      Effect effect : ability.getEffects(game,EffectType.CONTINUOUS)) {
        layerEffects.add((ContinuousEffect)effect);
        abilityMap.put(effect.getId(),ability);
      }
    }
  }
  Collections.sort(layerEffects,new TimestampSorter());
  return layerEffects;
}
