{
  List<ContinuousEffect> layerEffects=new ArrayList<ContinuousEffect>(layeredEffects);
  for (  Card card : game.getCards()) {
    Zone zone=game.getState().getZone(card.getId());
    if (zone == Zone.HAND || zone == Zone.GRAVEYARD) {
      for (      Entry<Effect,Ability> entry : card.getAbilities().getEffects(zone,EffectType.CONTINUOUS).entrySet()) {
        layerEffects.add((ContinuousEffect)entry.getKey());
        abilityMap.put(entry.getKey().getId(),entry.getValue());
      }
    }
  }
  for (  Permanent permanent : game.getBattlefield().getAllPermanents()) {
    for (    Entry<Effect,Ability> entry : permanent.getAbilities().getEffects(Zone.BATTLEFIELD,EffectType.CONTINUOUS).entrySet()) {
      layerEffects.add((ContinuousEffect)entry.getKey());
      abilityMap.put(entry.getKey().getId(),entry.getValue());
    }
  }
  Collections.sort(layerEffects,new TimestampSorter());
  return layerEffects;
}
