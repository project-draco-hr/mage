{
  if (!targets.isEmpty()) {
    if (target instanceof TargetPermanent) {
      for (      Permanent permanent : game.getBattlefield().getAllActivePermanents((FilterPermanent)target.getFilter(),game)) {
        for (        String _target : targets) {
          if (permanent.getName().equals(_target)) {
            if (((TargetPermanent)target).canTarget(playerId,permanent.getId(),null,game) && !target.getTargets().contains(permanent.getId())) {
              target.add(permanent.getId(),game);
              targets.remove(_target);
              return true;
            }
          }
 else           if ((permanent.getName() + "-" + permanent.getExpansionSetCode()).equals(_target)) {
            if (((TargetPermanent)target).canTarget(playerId,permanent.getId(),null,game) && !target.getTargets().contains(permanent.getId())) {
              target.add(permanent.getId(),game);
              targets.remove(_target);
              return true;
            }
          }
        }
      }
    }
  }
  return super.chooseTarget(outcome,target,source,game);
}
