{
  if (!targets.isEmpty()) {
    if (target instanceof TargetPermanent) {
      for (      String targetDefinition : targets) {
        String[] targetList=targetDefinition.split("\\^");
        boolean targetFound=false;
        for (        String targetName : targetList) {
          boolean allowCopy=true;
          if (targetName.endsWith("[no copy]")) {
            allowCopy=false;
            targetName=targetName.substring(0,targetName.length() - 9);
          }
          for (          Permanent permanent : game.getBattlefield().getAllActivePermanents((FilterPermanent)target.getFilter(),game)) {
            if (permanent.getName().equals(targetName) || (permanent.getName() + "-" + permanent.getExpansionSetCode()).equals(targetName)) {
              if (((TargetPermanent)target).canTarget(source == null ? this.getId() : source.getControllerId(),permanent.getId(),source,game) && !target.getTargets().contains(permanent.getId())) {
                if (!permanent.isCopy() || allowCopy) {
                  target.add(permanent.getId(),game);
                  targetFound=true;
                  break;
                }
              }
            }
          }
        }
        if (targetFound) {
          targets.remove(targetDefinition);
          return true;
        }
      }
    }
    if (target instanceof TargetPlayer) {
      for (      String targetDefinition : targets) {
        if (targetDefinition.startsWith("targetPlayer=")) {
          String playerName=targetDefinition.substring(targetDefinition.indexOf("targetPlayer=") + 13);
          for (          Player player : game.getPlayers().values()) {
            if (player.getName().equals(playerName) && ((TargetPlayer)target).canTarget(playerId,player.getId(),source,game)) {
              target.add(player.getId(),game);
              return true;
            }
          }
        }
      }
    }
    if (target instanceof TargetCardInHand) {
      for (      String targetDefinition : targets) {
        String[] targetList=targetDefinition.split("\\^");
        boolean targetFound=false;
        for (        String targetName : targetList) {
          for (          Card card : this.getHand().getCards(((TargetCardInHand)target).getFilter(),game)) {
            if (card.getName().equals(targetName) || (card.getName() + "-" + card.getExpansionSetCode()).equals(targetName)) {
              if (((TargetCardInHand)target).canTarget(source.getControllerId(),card.getId(),source,game) && !target.getTargets().contains(card.getId())) {
                target.add(card.getId(),game);
                targetFound=true;
                break;
              }
            }
          }
        }
        if (targetFound) {
          targets.remove(targetDefinition);
          return true;
        }
      }
    }
  }
  return super.chooseTarget(outcome,target,source,game);
}
