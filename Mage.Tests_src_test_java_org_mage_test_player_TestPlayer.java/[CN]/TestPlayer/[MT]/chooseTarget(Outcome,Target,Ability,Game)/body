{
  if (!targets.isEmpty()) {
    if (target instanceof TargetPermanent) {
      for (      String targetDefinition : targets) {
        String[] targetList=targetDefinition.split("\\^");
        boolean targetFound=false;
        for (        String targetName : targetList) {
          for (          Permanent permanent : game.getBattlefield().getAllActivePermanents((FilterPermanent)target.getFilter(),game)) {
            if (permanent.getName().equals(targetName) || (permanent.getName() + "-" + permanent.getExpansionSetCode()).equals(targetName)) {
              if (((TargetPermanent)target).canTarget(source.getControllerId(),permanent.getId(),source,game) && !target.getTargets().contains(permanent.getId())) {
                target.add(permanent.getId(),game);
                targetFound=true;
                break;
              }
            }
          }
        }
        if (targetFound) {
          targets.remove(targetDefinition);
          return true;
        }
      }
    }
  }
  return super.chooseTarget(outcome,target,source,game);
}
