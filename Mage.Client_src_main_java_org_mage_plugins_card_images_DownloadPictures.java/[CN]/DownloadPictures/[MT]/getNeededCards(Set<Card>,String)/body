{
  ArrayList<CardInfo> cardsToDownload=new ArrayList<CardInfo>();
  ArrayList<CardInfo> allCardsUrls=new ArrayList<CardInfo>();
  try {
    offlineMode=true;
    for (    Card card : allCards) {
      if (card.getCardNumber() > 0 && !card.getExpansionSetCode().isEmpty()) {
        String cardName=card.getName();
        CardInfo url=new CardInfo(cardName,card.getExpansionSetCode(),card.getCardNumber(),0,false,card.canTransform(),card.isNightCard());
        if (basicLandPattern.matcher(cardName).matches()) {
          url.setDownloadName(card.getClass().getName().replace(card.getClass().getPackage().getName() + ".",""));
        }
        if (card.isFlipCard()) {
          url.setFlipCard(true);
        }
        allCardsUrls.add(url);
        if (card.canTransform()) {
          Card secondSide=card.getSecondCardFace();
          url=new CardInfo(secondSide.getName(),card.getExpansionSetCode(),card.getCardNumber(),0,false,card.canTransform(),true);
          allCardsUrls.add(url);
        }
      }
 else {
        if (card.getCardNumber() < 1) {
          System.err.println("There was a critical error!");
          log.error("Card has no collector ID and won't be sent to client: " + card);
        }
 else         if (card.getExpansionSetCode().isEmpty()) {
          System.err.println("There was a critical error!");
          log.error("Card has no set name and won't be sent to client:" + card);
        }
      }
    }
    allCardsUrls.addAll(getTokenCardUrls());
  }
 catch (  Exception e) {
    log.error(e);
  }
  File file;
  for (  CardInfo card : allCardsUrls) {
    boolean withCollectorId=false;
    if (basicLandPattern.matcher(card.getName()).matches()) {
      withCollectorId=true;
    }
    file=new File(CardImageUtils.getImagePath(card,withCollectorId,imagesPath));
    if (!file.exists()) {
      cardsToDownload.add(card);
    }
  }
  for (  CardInfo card : cardsToDownload) {
    if (card.isToken()) {
      log.info("Card to download: " + card.getName() + " (Token) ");
    }
 else {
      try {
        log.info("Card to download: " + card.getName() + " ("+ card.getSet()+ ")");
      }
 catch (      Exception e) {
        log.error(e);
      }
    }
  }
  return cardsToDownload;
}
