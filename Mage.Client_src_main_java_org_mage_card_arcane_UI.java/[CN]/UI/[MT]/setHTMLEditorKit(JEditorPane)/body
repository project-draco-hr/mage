{
  editorPane.getDocument().putProperty("imageCache",imageCache);
  editorPane.setEditorKit(new HTMLEditorKit(){
    private static final long serialVersionUID=-54602188235105448L;
    @Override public ViewFactory getViewFactory(){
      return new HTMLFactory(){
        @Override public View create(        Element elem){
          Object o=elem.getAttributes().getAttribute(StyleConstants.NameAttribute);
          if (o instanceof HTML.Tag) {
            HTML.Tag kind=(HTML.Tag)o;
            if (kind == HTML.Tag.IMG) {
              return new ImageView(elem){
                @Override public URL getImageURL(){
                  URL url=super.getImageURL();
                  URI uri=null;
                  try {
                    uri=url.toURI();
                  }
 catch (                  URISyntaxException ex) {
                  }
                  if (uri != null && imageCache.get(uri) == null) {
                    imageCache.put(uri,Toolkit.getDefaultToolkit().createImage(url));
                  }
                  return url;
                }
              }
;
            }
          }
          return super.create(elem);
        }
      }
;
    }
  }
);
}
