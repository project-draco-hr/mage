{
  if (isConnected()) {
    logger.info("DISCONNECT (still connected)");
    sessionState=SessionState.DISCONNECTING;
  }
  if (connection == null || sessionState == SessionState.DISCONNECTED) {
    return;
  }
  try {
    callbackClient.removeListener(callbackHandler);
    callbackClient.disconnect();
    TransporterClient.destroyTransporterClient(server);
  }
 catch (  Throwable ex) {
    logger.fatal("Error disconnecting ...",ex);
  }
  if (sessionState == SessionState.DISCONNECTING || sessionState == SessionState.CONNECTING) {
    sessionState=SessionState.DISCONNECTED;
    logger.info("Disconnected ... ");
    if (askForReconnect) {
      client.showError("Network error.  You have been disconnected from " + connection.getHost());
    }
    client.disconnected(askForReconnect);
    pingTime.clear();
  }
}
