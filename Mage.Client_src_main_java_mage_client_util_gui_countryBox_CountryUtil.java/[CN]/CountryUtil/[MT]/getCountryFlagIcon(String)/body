{
  ImageIcon flagIcon=FLAG_ICON_CACHE.get(countryCode);
  if (flagIcon == null) {
    Image flagImage=ImageHelper.getImageFromResources("/flags/" + countryCode + (countryCode.endsWith(".png") ? "" : ".png"));
    if (flagImage != null) {
      if (GUISizeHelper.flagHeight > 11) {
        int width=Math.round(GUISizeHelper.flagHeight * flagImage.getWidth(null) / flagImage.getHeight(null));
        BufferedImage resized=ImageHelper.scale((BufferedImage)flagImage,BufferedImage.TYPE_4BYTE_ABGR,width,GUISizeHelper.flagHeight);
        flagIcon=new ImageIcon(resized);
      }
 else {
        flagIcon=new ImageIcon(flagImage);
      }
    }
    if (flagIcon == null || flagIcon.getImage() == null) {
      LOGGER.warn("Country flag resource not found: " + countryCode);
      FLAG_ICON_CACHE.put(countryCode,flagIcon);
    }
 else {
      FLAG_ICON_CACHE.put(countryCode,flagIcon);
    }
  }
  return flagIcon;
}
