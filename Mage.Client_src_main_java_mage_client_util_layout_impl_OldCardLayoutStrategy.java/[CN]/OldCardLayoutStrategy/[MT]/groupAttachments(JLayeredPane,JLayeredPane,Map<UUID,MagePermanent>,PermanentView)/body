{
  MagePermanent perm=permanents.get(permanent.getId());
  if (perm == null) {
    return;
  }
  int position=jLayeredPane.getPosition(perm);
  perm.getLinks().clear();
  Rectangle r=perm.getBounds();
  if (!Plugins.getInstance().isCardPluginLoaded()) {
    for (    UUID attachmentId : permanent.getAttachments()) {
      MagePermanent link=permanents.get(attachmentId);
      if (link != null) {
        perm.getLinks().add(link);
        r.translate(20,20);
        link.setBounds(r);
        jLayeredPane.setPosition(link,++position);
      }
    }
  }
 else {
    int index=permanent.getAttachments().size();
    for (    UUID attachmentId : permanent.getAttachments()) {
      MagePermanent link=permanents.get(attachmentId);
      if (link != null) {
        link.setBounds(r);
        perm.getLinks().add(link);
        if (index == 1) {
          r.translate(ATTACHMENTS_DX_OFFSET,ATTACHMENT_DY_OFFSET);
        }
 else {
          r.translate(ATTACHMENT_DX_OFFSET,ATTACHMENT_DY_OFFSET);
        }
        perm.setBounds(r);
        jLayeredPane.moveToFront(link);
        jLayeredPane.moveToFront(perm);
        jPanel.setComponentZOrder(link,index);
        index--;
      }
    }
    jPanel.setComponentZOrder(perm,index);
  }
}
