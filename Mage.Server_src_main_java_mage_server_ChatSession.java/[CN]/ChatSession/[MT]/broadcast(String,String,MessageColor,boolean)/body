{
  if (!message.isEmpty()) {
    Calendar cal=new GregorianCalendar();
    final String msg=message;
    final String time=(withTime ? timeFormatter.format(cal.getTime()) : "");
    final String username=userName;
    logger.debug("Broadcasting '" + msg + "' for "+ chatId);
    for (    UUID userId : clients.keySet()) {
      User user=UserManager.getInstance().getUser(userId);
      if (user != null)       user.fireCallback(new ClientCallback("chatMessage",chatId,new ChatMessage(username,msg,time,color)));
 else       kill(userId);
    }
  }
}
