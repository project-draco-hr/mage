{
  UUID currentPlayerId=node.getGame().getPlayerList().get();
  SimulationNode bestChild=null;
  boolean isSimulatedPlayer=currentPlayerId.equals(playerId);
  for (  SimulationNode child : node.getChildren()) {
    if (alpha >= beta) {
      logger.debug("alpha beta pruning");
      break;
    }
    if (SimulationNode.nodeCount > maxNodes) {
      logger.debug("simulating -- reached end-state");
      break;
    }
    int val=addActions(child,filter,depth - 1,alpha,beta);
    if (!isSimulatedPlayer) {
      if (val < beta) {
        beta=val;
        bestChild=child;
        node.setCombat(child.getCombat());
      }
      if (val == GameStateEvaluator.LOSE_SCORE) {
        logger.debug("simulating -- lose, can't do worse than this");
        break;
      }
    }
 else {
      if (val > alpha) {
        alpha=val;
        bestChild=child;
        node.setCombat(child.getCombat());
      }
      if (val == GameStateEvaluator.WIN_SCORE) {
        logger.debug("simulating -- win, can't do better than this");
        break;
      }
    }
  }
  node.children.clear();
  if (bestChild != null)   node.children.add(bestChild);
  if (!isSimulatedPlayer) {
    logger.debug("returning minimax beta: " + beta);
    return beta;
  }
 else {
    logger.debug("returning minimax alpha: " + alpha);
    return alpha;
  }
}
