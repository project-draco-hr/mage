{
  int total=0;
  Iterator<ManaPoolItem> it=manaItems.iterator();
  while (it.hasNext()) {
    ManaPoolItem item=it.next();
    ConditionalMana conditionalItem=item.getConditionalMana();
    for (    ManaType manaType : ManaType.values()) {
      if (!doNotEmptyManaTypes.contains(manaType)) {
        if (item.get(manaType) > 0) {
          if (!item.getDuration().equals(Duration.EndOfTurn) || game.getPhase().getType().equals(TurnPhase.END)) {
            if (game.replaceEvent(new GameEvent(GameEvent.EventType.EMPTY_MANA_POOL,playerId,null,playerId))) {
              int amount=item.get(manaType);
              item.clear(manaType);
              item.add(ManaType.COLORLESS,amount);
            }
 else {
              total+=item.get(manaType);
              item.clear(manaType);
            }
          }
        }
        if (conditionalItem != null) {
          if (conditionalItem.get(manaType) > 0) {
            if (!item.getDuration().equals(Duration.EndOfTurn) || game.getPhase().getType().equals(TurnPhase.END)) {
              if (game.replaceEvent(new GameEvent(GameEvent.EventType.EMPTY_MANA_POOL,playerId,null,playerId))) {
                int amount=conditionalItem.get(manaType);
                conditionalItem.clear(manaType);
                conditionalItem.add(ManaType.COLORLESS,amount);
              }
 else {
                total+=conditionalItem.get(manaType);
                conditionalItem.clear(manaType);
              }
            }
          }
        }
      }
    }
    if (item.count() == 0) {
      it.remove();
    }
  }
  return total;
}
