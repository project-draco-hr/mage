{
  Permanent permanent=game.getPermanentOrLKIBattlefield(event.getSourceId());
  if (permanent != null && filter.match(permanent,getSourceId(),getControllerId(),game)) {
    ManaEvent mEvent=(ManaEvent)event;
    ObjectColor color=(ObjectColor)game.getState().getValue(getSourceId() + "_color");
    if (color != null) {
      Mana mana=mEvent.getMana();
      boolean colorFits=false;
      if (color.isBlack() && mana.getBlack() > 0) {
        colorFits=true;
      }
 else       if (color.isBlue() && mana.getBlue() > 0) {
        colorFits=true;
      }
 else       if (color.isGreen() && mana.getGreen() > 0) {
        colorFits=true;
      }
 else       if (color.isWhite() && mana.getWhite() > 0) {
        colorFits=true;
      }
 else       if (color.isRed() && mana.getRed() > 0) {
        colorFits=true;
      }
      if (colorFits) {
        for (        Effect effect : getEffects()) {
          effect.setValue("mana",mEvent.getMana());
        }
switch (setTargetPointer) {
case PERMANENT:
          getEffects().get(0).setTargetPointer(new FixedTarget(permanent.getId()));
        break;
case PLAYER:
      getEffects().get(0).setTargetPointer(new FixedTarget(permanent.getControllerId()));
    break;
}
return true;
}
}
}
return false;
}
