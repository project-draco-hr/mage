{
  JPopupMenu menu=new JPopupMenu();
  JInternalFrame[] windows=desktopPane.getAllFramesInLayer(javax.swing.JLayeredPane.DEFAULT_LAYER);
  MagePaneMenuItem menuItem;
  for (int i=0; i < windows.length; i++) {
    JInternalFrame window=windows[i];
    if (window.isVisible()) {
      menuItem=new MagePaneMenuItem(window);
      menuItem.setState(i == 0);
      menuItem.addActionListener(new ActionListener(){
        public void actionPerformed(        ActionEvent ae){
          JInternalFrame frame=((MagePaneMenuItem)ae.getSource()).getFrame();
          frame.toFront();
          frame.setVisible(true);
          try {
            frame.setSelected(true);
          }
 catch (          PropertyVetoException e) {
            e.printStackTrace();
          }
        }
      }
);
      menuItem.setIcon(window.getFrameIcon());
      menu.add(menuItem);
    }
  }
  menu.addPopupMenuListener(new PopupMenuListener(){
    public void popupMenuWillBecomeVisible(    PopupMenuEvent e){
    }
    public void popupMenuWillBecomeInvisible(    PopupMenuEvent e){
      windowButton.setSelected(false);
    }
    public void popupMenuCanceled(    PopupMenuEvent e){
      windowButton.setSelected(false);
    }
  }
);
  menu.show(component,0,component.getHeight());
}
