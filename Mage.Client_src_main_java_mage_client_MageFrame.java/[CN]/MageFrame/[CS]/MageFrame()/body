{
  EDTExceptionHandler.registerExceptionHandler();
  addWindowListener(new WindowAdapter(){
    @Override public void windowClosing(    WindowEvent e){
      exitApp();
    }
  }
);
  try {
    UIManager.setLookAndFeel("com.sun.java.swing.plaf.nimbus.NimbusLookAndFeel");
  }
 catch (  Exception ex) {
    logger.log(Level.SEVERE,null,ex);
  }
  Plugins.getInstance().loadPlugins();
  initComponents();
  session=new Session(this);
  connectDialog=new ConnectDialog();
  combat=new CombatDialog();
  pickNumber=new PickNumberDialog();
  desktopPane.add(connectDialog,JLayeredPane.POPUP_LAYER);
  desktopPane.add(combat,JLayeredPane.POPUP_LAYER);
  combat.hideDialog();
  desktopPane.add(pickNumber,JLayeredPane.POPUP_LAYER);
  if (autoConnect())   enableButtons();
 else   disableButtons();
  if (Plugins.getInstance().isCardPluginLoaded()) {
    Separator separator=new javax.swing.JToolBar.Separator();
    mageToolbar.add(separator);
    JButton btnDownload=new JButton("Images");
    btnDownload.setBorder(javax.swing.BorderFactory.createEmptyBorder(1,1,1,1));
    btnDownload.setFocusable(false);
    btnDownload.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    btnDownload.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
    btnDownload.addActionListener(new java.awt.event.ActionListener(){
      public void actionPerformed(      java.awt.event.ActionEvent evt){
        btnImagesActionPerformed(evt);
      }
    }
);
    mageToolbar.add(btnDownload);
  }
}
