{
  int bookmark=0;
  try {
    while (!isPaused() && !isGameOver()) {
      if (!resuming) {
        state.getPlayers().resetPassed();
        state.getPlayerList().setCurrent(activePlayerId);
      }
 else {
        state.getPlayerList().setCurrent(this.getPriorityPlayerId());
      }
      Player player;
      while (!isPaused() && !isGameOver()) {
        try {
          if (bookmark == 0)           bookmark=bookmarkState();
          player=getPlayer(state.getPlayerList().get());
          state.setPriorityPlayerId(player.getId());
          while (!player.isPassed() && !player.hasLost() && !player.hasLeft()&& !isPaused()&& !isGameOver()) {
            if (!resuming) {
              checkStateAndTriggered();
              if (isPaused() || isGameOver())               return;
              player.priority(this);
              if (isPaused())               return;
            }
            resuming=false;
            applyEffects();
          }
          if (isPaused() || isGameOver())           return;
          if (allPassed()) {
            if (!state.getStack().isEmpty()) {
              resolve();
              applyEffects();
              state.getPlayers().resetPassed();
              fireUpdatePlayersEvent();
              state.getRevealed().reset();
              break;
            }
 else {
              removeBookmark(bookmark);
              return;
            }
          }
        }
 catch (        Exception ex) {
          logger.fatal("Game exception ",ex);
          this.fireErrorEvent("Game exception occurred: ",ex);
          restoreState(bookmark);
          bookmark=0;
          continue;
        }
        state.getPlayerList().getNext();
      }
      removeBookmark(bookmark);
      bookmark=0;
    }
  }
 catch (  Exception ex) {
    logger.fatal("Game exception ",ex);
    this.fireErrorEvent("Game exception occurred: ",ex);
  }
 finally {
    resetLKI();
  }
}
