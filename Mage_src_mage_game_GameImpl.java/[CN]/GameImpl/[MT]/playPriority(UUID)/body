{
  try {
    while (!isGameOver()) {
      state.getPlayers().resetPassed();
      state.getPlayerList().setCurrent(activePlayerId);
      Player player;
      while (!isGameOver()) {
        player=getPlayer(state.getPlayerList().get());
        state.setPriorityPlayerId(player.getId());
        while (!player.isPassed() && !player.hasLost() && !player.hasLeft()&& !isGameOver()) {
          checkStateAndTriggered();
          if (isGameOver())           return;
          player.priority(this);
          if (isGameOver())           return;
          applyEffects();
        }
        if (isGameOver())         return;
        if (allPassed()) {
          if (!state.getStack().isEmpty()) {
            state.getStack().resolve(this);
            applyEffects();
            state.getPlayers().resetPassed();
            fireUpdatePlayersEvent();
            break;
          }
 else           return;
        }
        state.getPlayerList().getNext();
      }
    }
  }
  finally {
    resetLKI();
  }
}
