{
  UUID activePlayerId=state.getTurn().getActivePlayerId();
  if (!replaceEvent(new GameEvent(GameEvent.EventType.BEGIN_COMBAT_STEP,null,null,activePlayerId))) {
    state.getCombat().clear();
    state.getCombat().setAttacker(activePlayerId);
    for (    Player player : state.getPlayers().values()) {
      if (!player.getId().equals(state.getTurn().getActivePlayerId()))       state.getCombat().getDefenders().add(player.getId());
    }
    fireEvent(new GameEvent(GameEvent.EventType.BEGIN_COMBAT_STEP_PRE,null,null,activePlayerId));
    playPriority();
    fireEvent(new GameEvent(GameEvent.EventType.PRECOMBAT_MAIN_STEP_POST,null,null,activePlayerId));
  }
}
