{
  UUID activePlayerId=state.getTurn().getActivePlayerId();
  if (!replaceEvent(new GameEvent(GameEvent.EventType.COMBAT_DAMAGE_STEP,null,null,activePlayerId))) {
    fireEvent(new GameEvent(GameEvent.EventType.COMBAT_DAMAGE_STEP_PRE,null,null,activePlayerId));
    for (    CombatGroup group : getCombat().getGroups()) {
      group.assignDamage(first,this);
    }
    playPriority();
    fireEvent(new GameEvent(GameEvent.EventType.COMBAT_DAMAGE_STEP_POST,null,null,activePlayerId));
  }
}
