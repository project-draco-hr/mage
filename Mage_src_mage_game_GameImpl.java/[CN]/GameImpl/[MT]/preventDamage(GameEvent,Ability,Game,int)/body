{
  if (!(event instanceof DamageEvent)) {
    return false;
  }
  DamageEvent damageEvent=(DamageEvent)event;
  GameEvent preventEvent=new GameEvent(GameEvent.EventType.PREVENT_DAMAGE,damageEvent.getTargetId(),damageEvent.getSourceId(),source.getControllerId(),damageEvent.getAmount(),false);
  if (!game.replaceEvent(preventEvent)) {
    int preventedDamage;
    if (event.getAmount() > amountToPrevent) {
      preventedDamage=amountToPrevent;
      damageEvent.setAmount(event.getAmount() - amountToPrevent);
    }
 else {
      preventedDamage=event.getAmount();
      damageEvent.setAmount(0);
    }
    if (amountToPrevent != Integer.MAX_VALUE) {
      amountToPrevent-=preventedDamage;
      event.setData(Integer.toString(amountToPrevent));
    }
    MageObject damageSource=game.getObject(damageEvent.getSourceId());
    MageObject preventionSource=game.getObject(source.getSourceId());
    if (damageSource != null && preventionSource != null) {
      MageObject targetObject=game.getObject(event.getTargetId());
      String targetName="";
      if (targetObject == null) {
        Player targetPlayer=game.getPlayer(event.getTargetId());
        if (targetPlayer != null) {
          targetName=targetPlayer.getName();
        }
      }
 else {
        targetName=targetObject.getName();
      }
      StringBuilder message=new StringBuilder(preventionSource.getName()).append(": Prevented ");
      message.append(Integer.toString(preventedDamage)).append(" damage from ").append(damageSource.getName());
      if (!targetName.isEmpty()) {
        message.append(" to ").append(targetName);
      }
      game.informPlayers(message.toString());
    }
    game.fireEvent(GameEvent.getEvent(GameEvent.EventType.PREVENTED_DAMAGE,damageEvent.getTargetId(),source.getSourceId(),source.getControllerId(),preventedDamage));
    return true;
  }
  return false;
}
