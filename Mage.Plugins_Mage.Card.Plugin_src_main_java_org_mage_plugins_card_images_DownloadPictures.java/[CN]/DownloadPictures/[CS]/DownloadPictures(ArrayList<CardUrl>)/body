{
  this.cards=cards;
  this.cardsInGame=new ArrayList<CardUrl>();
  for (  CardUrl url : cards) {
    if (url.isExistsInTheGame())     cardsInGame.add(url);
  }
  addr=new JTextField("Proxy Address");
  port=new JTextField("Proxy Port");
  bar=new JProgressBar(this);
  JPanel p0=new JPanel();
  p0.setLayout(new BoxLayout(p0,BoxLayout.Y_AXIS));
  ButtonGroup bg=new ButtonGroup();
  String[] labels={"No Proxy","HTTP Proxy","SOCKS Proxy"};
  for (int i=0; i < types.length; i++) {
    JRadioButton rb=new JRadioButton(labels[i]);
    rb.addChangeListener(new ProxyHandler(i));
    bg.add(rb);
    p0.add(rb);
    if (i == 0)     rb.setSelected(true);
  }
  p0.add(addr);
  p0.add(port);
  p0.add(Box.createVerticalStrut(5));
  jLabel1=new JLabel();
  jLabel1.setText("Please select server:");
  jLabel1.setAlignmentX(Component.LEFT_ALIGNMENT);
  p0.add(jLabel1);
  p0.add(Box.createVerticalStrut(5));
  ComboBoxModel jComboBox1Model=new DefaultComboBoxModel(new String[]{"magiccards.info","wizards.com"});
  jComboBox1=new JComboBox();
  cardImageSource=MagicCardsImageSource.getInstance();
  jComboBox1.setModel(jComboBox1Model);
  jComboBox1.setAlignmentX(Component.LEFT_ALIGNMENT);
  jComboBox1.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      JComboBox cb=(JComboBox)e.getSource();
switch (cb.getSelectedIndex()) {
case 0:
        cardImageSource=MagicCardsImageSource.getInstance();
      break;
case 1:
    cardImageSource=WizardCardsImageSource.getInstance();
  break;
}
}
}
);
p0.add(jComboBox1);
p0.add(Box.createVerticalStrut(5));
final JButton b=new JButton("Start download");
b.addActionListener(new ActionListener(){
@Override public void actionPerformed(ActionEvent e){
new Thread(DownloadPictures.this).start();
b.setEnabled(false);
checkBox.setEnabled(false);
}
}
);
p0.add(Box.createVerticalStrut(5));
p0.add(bar);
bar.setStringPainted(true);
int count=cards.size();
float mb=(count * 70.0f) / 1024;
bar.setString(String.format(cardIndex == cards.size() ? "%d of %d cards finished! Please close!" : "%d of %d cards finished! Please wait! [%.1f Mb]",0,cards.size(),mb));
Dimension d=bar.getPreferredSize();
d.width=300;
bar.setPreferredSize(d);
p0.add(Box.createVerticalStrut(5));
checkBox=new JCheckBox("Download for current game only.");
p0.add(checkBox);
p0.add(Box.createVerticalStrut(5));
checkBox.setEnabled(!offlineMode);
checkBox.addActionListener(new ActionListener(){
@Override public void actionPerformed(ActionEvent e){
if (checkBox.isSelected()) {
int count=DownloadPictures.this.cardsInGame.size();
float mb=(count * 70.0f) / 1024;
bar.setString(String.format(count == 0 ? "No images to download!" : "%d of %d cards finished! Please wait! [%.1f Mb]",0,DownloadPictures.this.cardsInGame.size(),mb));
}
 else {
int count=DownloadPictures.this.cards.size();
float mb=(count * 70.0f) / 1024;
bar.setString(String.format(cardIndex == count ? "%d of %d cards finished! Please close!" : "%d of %d cards finished! Please wait! [%.1f Mb]",0,count,mb));
}
}
}
);
Object[] options={b,close=new JButton("Cancel")};
dlg=new JOptionPane(p0,JOptionPane.DEFAULT_OPTION,JOptionPane.PLAIN_MESSAGE,null,options,options[1]);
}
