{
  if (!ability.getSpellAbilityType().equals(SpellAbilityType.BASE)) {
    ability=chooseSpellAbilityForCast(ability,game,noMana);
  }
  Card card=game.getCard(ability.getSourceId());
  if (card != null) {
    if (!game.replaceEvent(GameEvent.getEvent(GameEvent.EventType.CAST_SPELL,ability.getId(),ability.getSourceId(),playerId))) {
      int bookmark=game.bookmarkState();
      Zone fromZone=game.getState().getZone(card.getMainCard().getId());
      card.cast(game,fromZone,ability,playerId);
      Spell spell=game.getStack().getSpell(ability.getId());
      if (ability.getSourceId().equals(getCastSourceIdWithAlternateMana())) {
        ManaCosts alternateCosts=getCastSourceIdManaCosts();
        Ability spellAbility=spell.getSpellAbility();
        if (alternateCosts == null) {
          noMana=true;
        }
 else {
          spellAbility.getManaCosts().clear();
          spellAbility.getManaCosts().add(alternateCosts.copy());
          spellAbility.getManaCostsToPay().clear();
          spellAbility.getManaCostsToPay().add(alternateCosts.copy());
        }
      }
      setCastSourceIdWithAlternateMana(null,null);
      GameEvent event=GameEvent.getEvent(GameEvent.EventType.CAST_SPELL,spell.getSpellAbility().getId(),spell.getSpellAbility().getSourceId(),playerId);
      game.fireEvent(event);
      if (spell.activate(game,noMana)) {
        event=GameEvent.getEvent(GameEvent.EventType.SPELL_CAST,spell.getSpellAbility().getId(),spell.getSpellAbility().getSourceId(),playerId);
        event.setZone(fromZone);
        game.fireEvent(event);
        if (!game.isSimulation()) {
          game.informPlayers(getLogName() + spell.getActivatedMessage(game));
        }
        game.removeBookmark(bookmark);
        resetStoredBookmark(game);
        return true;
      }
      restoreState(bookmark,ability.getRule(),game);
    }
  }
  return false;
}
