{
  for (  Permanent permanent : game.getBattlefield().getAllActivePermanents(playerId)) {
    boolean untap=true;
    for (    RestrictionEffect effect : game.getContinuousEffects().getApplicableRestrictionEffects(permanent,game).keySet()) {
      untap&=effect.canBeUntapped(permanent,game);
    }
    if (untap) {
      permanent.untap(game);
    }
  }
}
