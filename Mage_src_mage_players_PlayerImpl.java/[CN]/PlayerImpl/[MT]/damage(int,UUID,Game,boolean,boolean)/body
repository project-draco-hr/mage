{
  if (damage > 0 && canDamage(game.getObject(sourceId),game)) {
    GameEvent event=new DamagePlayerEvent(playerId,sourceId,playerId,damage,preventable,combatDamage);
    if (!game.replaceEvent(event)) {
      int actualDamage=event.getAmount();
      if (actualDamage > 0) {
        Permanent source=game.getPermanent(sourceId);
        if (source == null) {
          MageObject lastKnownInformation=game.getLastKnownInformation(sourceId,Zone.BATTLEFIELD);
          if (lastKnownInformation instanceof Permanent) {
            source=(Permanent)lastKnownInformation;
          }
        }
        if (source != null && (source.getAbilities().containsKey(InfectAbility.getInstance().getId()))) {
          addCounters(CounterType.POISON.createInstance(actualDamage),game);
        }
 else {
          this.loseLife(actualDamage,game);
        }
        if (source != null && source.getAbilities().containsKey(LifelinkAbility.getInstance().getId())) {
          Player player=game.getPlayer(source.getControllerId());
          player.gainLife(damage,game);
        }
        game.fireEvent(new DamagedPlayerEvent(playerId,sourceId,playerId,actualDamage,combatDamage));
        return actualDamage;
      }
    }
  }
  return 0;
}
