{
  for (  Permanent permanent : game.getBattlefield().getAllActivePermanents(filter,game)) {
    if (permanent != null) {
switch (layer) {
case TypeChangingEffects_4:
        if (loseOther) {
          permanent.getSubtype().clear();
          permanent.getSubtype().addAll(subtypes);
        }
 else {
          for (          String subtype : subtypes) {
            if (!permanent.getSubtype().contains(subtype)) {
              permanent.getSubtype().add(subtype);
            }
          }
        }
      break;
  }
}
 else {
  if (duration.equals(Duration.Custom)) {
    discard();
  }
}
}
return true;
}
