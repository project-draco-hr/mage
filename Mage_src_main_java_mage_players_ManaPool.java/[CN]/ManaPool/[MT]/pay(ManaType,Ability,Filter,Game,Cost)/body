{
  if (!autoPayment && !manaType.equals(unlockedManaType)) {
    return false;
  }
  if (autoPayment && autoPaymentRestricted && !wasManaAddedBeyondStock()&& !manaType.equals(unlockedManaType)) {
    return false;
  }
  if (getConditional(manaType,ability,filter,game,costToPay) > 0) {
    removeConditional(manaType,ability,game,costToPay);
    lockManaType();
    return true;
  }
  for (  ManaPoolItem mana : manaItems) {
    if (filter != null) {
      MageObject sourceObject=game.getObject(mana.getSourceId());
      if (!filter.match(sourceObject,game)) {
        continue;
      }
    }
    if (!manaType.equals(unlockedManaType) && autoPayment && autoPaymentRestricted&& mana.count() == mana.getStock()) {
      continue;
    }
    ManaType usableManaType=game.getContinuousEffects().asThoughMana(manaType,mana,ability.getSourceId(),ability,ability.getControllerId(),game);
    if (usableManaType == null) {
      continue;
    }
    if (mana.get(usableManaType) > 0) {
      GameEvent event=new GameEvent(GameEvent.EventType.MANA_PAYED,ability.getId(),mana.getSourceId(),ability.getControllerId(),0,mana.getFlag());
      event.setData(mana.getOriginalId().toString());
      game.fireEvent(event);
      mana.remove(usableManaType);
      if (mana.count() == 0) {
        manaItems.remove(mana);
      }
      lockManaType();
      return true;
    }
  }
  return false;
}
