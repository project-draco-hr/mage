{
  Player controller=game.getPlayer(source.getControllerId());
  if (controller != null) {
    ObjectColor color=(ObjectColor)game.getState().getValue(source.getSourceId() + "_color");
    if (color == null) {
      return false;
    }
    String colorString=color.toString();
    for (    Permanent perm : game.getBattlefield().getActivePermanents(source.getControllerId(),game)) {
switch (colorString) {
case "W":
        perm.getColor().setWhite(true);
      break;
case "B":
    perm.getColor().setBlack(true);
  break;
case "U":
perm.getColor().setBlue(true);
break;
case "G":
perm.getColor().setGreen(true);
break;
case "R":
perm.getColor().setRed(true);
break;
}
}
for (UUID playerId : controller.getInRange()) {
Player player=game.getPlayer(playerId);
if (player != null) {
for (Card card : player.getHand().getCards(game)) {
switch (colorString) {
case "W":
card.getColor().setWhite(true);
break;
case "B":
card.getColor().setBlack(true);
break;
case "U":
card.getColor().setBlue(true);
break;
case "G":
card.getColor().setGreen(true);
break;
case "R":
card.getColor().setRed(true);
break;
}
}
for (Card card : player.getLibrary().getCards(game)) {
switch (colorString) {
case "W":
card.getColor().setWhite(true);
break;
case "B":
card.getColor().setBlack(true);
break;
case "U":
card.getColor().setBlue(true);
break;
case "G":
card.getColor().setGreen(true);
break;
case "R":
card.getColor().setRed(true);
break;
}
}
}
for (MageObject object : game.getStack()) {
if (object instanceof Spell) {
switch (colorString) {
case "W":
object.getColor().setWhite(true);
break;
case "B":
object.getColor().setBlack(true);
break;
case "U":
object.getColor().setBlue(true);
break;
case "G":
object.getColor().setGreen(true);
break;
case "R":
object.getColor().setRed(true);
break;
}
}
}
for (Card card : game.getExile().getAllCards(game)) {
switch (colorString) {
case "W":
card.getColor().setWhite(true);
break;
case "B":
card.getColor().setBlack(true);
break;
case "U":
card.getColor().setBlue(true);
break;
case "G":
card.getColor().setGreen(true);
break;
case "R":
card.getColor().setRed(true);
break;
}
}
}
return true;
}
return false;
}
