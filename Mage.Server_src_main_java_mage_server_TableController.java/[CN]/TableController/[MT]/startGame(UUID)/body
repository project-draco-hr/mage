{
  try {
    match.startGame();
    table.initGame();
    GameManager.getInstance().createGameSession(match.getGame(),userPlayerMap,table.getId(),choosingPlayerId);
    String creator=null;
    StringBuilder opponent=new StringBuilder();
    for (    Entry<UUID,UUID> entry : userPlayerMap.entrySet()) {
      if (!match.getPlayer(entry.getValue()).hasQuit()) {
        User user=UserManager.getInstance().getUser(entry.getKey());
        if (user != null) {
          if (!user.isConnected()) {
            user.removeConstructing(match.getPlayer(entry.getValue()).getPlayer().getId());
            GameManager.getInstance().joinGame(match.getGame().getId(),user.getId());
          }
          logger.info(new StringBuilder("User ").append(user.getName()).append(" game started - matchId ").append(match.getId()).append(" userId: ").append(user.getId()));
          user.gameStarted(match.getGame().getId(),entry.getValue());
          if (creator == null) {
            creator=user.getName();
          }
 else {
            if (opponent.length() > 0) {
              opponent.append(" - ");
            }
            opponent.append(user.getName());
          }
        }
 else {
          logger.warn("Unable to find player " + entry.getKey());
          match.getPlayer(entry.getValue()).setQuit(true);
        }
      }
    }
    for (    MatchPlayer mPlayer : match.getPlayers()) {
      if (!mPlayer.getPlayer().isHuman()) {
        if (opponent.length() > 0) {
          opponent.append(" - ");
        }
        opponent.append(mPlayer.getName());
      }
    }
    ServerMessagesUtil.getInstance().incGamesStarted();
    LogServiceImpl.instance.log(LogKeys.KEY_GAME_STARTED,String.valueOf(userPlayerMap.size()),creator,opponent.toString());
  }
 catch (  Exception ex) {
    logger.fatal("Error starting game",ex);
    TableManager.getInstance().removeTable(table.getId());
    GameManager.getInstance().removeGame(match.getGame().getId());
  }
}
