{
  Player targetPlayer=game.getPlayer(source.getFirstTarget());
  Player controller=game.getPlayer(source.getControllerId());
  MageObject sourceObject=game.getObject(source.getSourceId());
  if (targetPlayer != null && sourceObject != null && controller != null) {
    targetPlayer.revealCards(sourceObject.getName(),targetPlayer.getHand(),game);
    TargetCardInHand target=new TargetCardInHand(filter);
    target.setNotTarget(true);
    Card chosenCard=null;
    if (controller.choose(Outcome.Benefit,targetPlayer.getHand(),target,game)) {
      chosenCard=game.getCard(target.getFirstTarget());
    }
    FilterCard filterNamedCards=new FilterCard();
    if (chosenCard != null) {
      filterNamedCards.add(new NamePredicate(chosenCard.getName()));
    }
 else {
      filterNamedCards.add(new NamePredicate("----"));
    }
    Cards cardsToExile=new CardsImpl();
    if (chosenCard != null) {
      for (      Card checkCard : targetPlayer.getGraveyard().getCards(game)) {
        if (checkCard.getName().equals(chosenCard.getName())) {
          cardsToExile.add(checkCard);
        }
      }
      TargetCardInHand targetCardsHand=new TargetCardInHand(0,Integer.MAX_VALUE,filterNamedCards);
      controller.chooseTarget(outcome,targetPlayer.getGraveyard(),targetCardsHand,source,game);
      for (      UUID cardId : targetCardsHand.getTargets()) {
        Card card=game.getCard(cardId);
        if (card != null) {
          cardsToExile.add(card);
        }
      }
    }
    if (chosenCard != null || controller.chooseUse(outcome,"Search library anyway?",source,game)) {
      TargetCardInLibrary targetCardsLibrary=new TargetCardInLibrary(0,Integer.MAX_VALUE,filterNamedCards);
      controller.searchLibrary(targetCardsLibrary,game,targetPlayer.getId());
      for (      UUID cardId : targetCardsLibrary.getTargets()) {
        Card card=game.getCard(cardId);
        if (card != null) {
          cardsToExile.add(card);
        }
      }
    }
    if (!cardsToExile.isEmpty()) {
      controller.moveCards(cardsToExile,null,Zone.EXILED,source,game);
    }
    targetPlayer.shuffleLibrary(game);
    return true;
  }
  return false;
}
