{
  boolean lockSet=false;
  try {
    if (lock.tryLock(500,TimeUnit.MILLISECONDS)) {
      lockSet=true;
      logger.trace("SESSION LOCK SET sessionId: " + sessionId);
      User user=UserManager.getInstance().getUser(userId);
      if (user == null || !user.isConnected()) {
        return;
      }
      if (!user.getSessionId().equals(sessionId)) {
        logger.info("OLD SESSION IGNORED - " + user.getName());
        return;
      }
      UserManager.getInstance().disconnect(userId,DisconnectReason.LostConnection);
    }
 else {
      logger.error("CAN'T GET LOCK - userId: " + userId);
    }
  }
 catch (  InterruptedException ex) {
    logger.error("SESSION LOCK lost connection - userId: " + userId,ex);
  }
 finally {
    if (lockSet) {
      lock.unlock();
      logger.trace("SESSION LOCK UNLOCK sessionId: " + sessionId);
    }
  }
}
