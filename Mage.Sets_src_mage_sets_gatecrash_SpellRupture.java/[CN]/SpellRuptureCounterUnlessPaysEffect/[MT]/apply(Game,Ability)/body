{
  StackObject spell=game.getStack().getStackObject(targetPointer.getFirst(game,source));
  if (spell != null) {
    Player player=game.getPlayer(spell.getControllerId());
    Player controller=game.getPlayer(source.getControllerId());
    int amount=new greatestPowerCountCreatureYouControl().calculate(game,source);
    if (player != null && controller != null) {
      if (amount > 0) {
        GenericManaCost cost=new GenericManaCost(amount);
        if (!cost.pay(source,game,spell.getControllerId(),spell.getControllerId(),false)) {
          StackObject stackObject=game.getStack().getStackObject(source.getFirstTarget());
          if (stackObject != null && !game.replaceEvent(GameEvent.getEvent(GameEvent.EventType.COUNTER,source.getFirstTarget(),source.getSourceId(),stackObject.getControllerId()))) {
            game.informPlayers("Spell Rupture: cost wasn't payed - countering " + stackObject.getName());
            if (stackObject instanceof Spell) {
              game.rememberLKI(source.getFirstTarget(),Constants.Zone.STACK,(Spell)stackObject);
            }
            game.getStack().counter(source.getFirstTarget(),source.getSourceId(),game);
            game.fireEvent(GameEvent.getEvent(GameEvent.EventType.COUNTERED,source.getFirstTarget(),source.getSourceId(),stackObject.getControllerId()));
            return true;
          }
          return false;
        }
      }
    }
  }
  return false;
}
