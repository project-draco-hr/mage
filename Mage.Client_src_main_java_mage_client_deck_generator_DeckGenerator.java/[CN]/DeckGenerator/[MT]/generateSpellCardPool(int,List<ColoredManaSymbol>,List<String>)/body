{
  List<Card> spellCardPool=new ArrayList<Card>();
  int count=0;
  List<Card> cardPool=new ArrayList<Card>();
  for (  Card card : CardsStorage.getAllCards()) {
    if (setsToUse.contains(card.getExpansionSetCode())) {
      cardPool.add(card);
    }
  }
  int cardPoolCount=cardPool.size();
  Random random=new Random();
  if (cardPoolCount > 0) {
    int tries=0;
    while (count < cardsCount) {
      Card card=cardPool.get(random.nextInt(cardPoolCount));
      if (!card.getCardType().contains(CardType.LAND)) {
        if (cardFitsChosenColors(card,allowedColors)) {
          spellCardPool.add(card);
          count++;
        }
      }
      tries++;
      if (tries > MAX_TRIES) {
        throw new IllegalStateException("Not enough cards for chosen colors to generate deck: " + selectedColors);
      }
    }
  }
 else {
    throw new IllegalStateException("Not enough cards to generate deck.");
  }
  return spellCardPool;
}
