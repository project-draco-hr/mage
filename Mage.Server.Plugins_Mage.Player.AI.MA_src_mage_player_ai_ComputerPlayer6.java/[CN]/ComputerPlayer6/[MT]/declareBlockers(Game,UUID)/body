{
  game.fireEvent(new GameEvent(GameEvent.EventType.DECLARE_BLOCKERS_STEP_PRE,null,null,activePlayerId));
  if (!game.replaceEvent(GameEvent.getEvent(GameEvent.EventType.DECLARING_BLOCKERS,activePlayerId,activePlayerId))) {
    List<Permanent> attackers=getAttackers(game);
    if (attackers == null) {
      return;
    }
    List<Permanent> possibleBlockers=super.getAvailableBlockers(game);
    possibleBlockers=filterOutNonblocking(game,attackers,possibleBlockers);
    if (possibleBlockers.isEmpty()) {
      return;
    }
    attackers=filterOutUnblockable(game,attackers,possibleBlockers);
    if (attackers.isEmpty()) {
      return;
    }
    CombatUtil.sortByPower(attackers,false);
    Player player=game.getPlayer(this.playerId);
    Player attackingPlayer=game.getPlayer(attackers.get(0).getControllerId());
    for (    Permanent attacker : attackers) {
      for (      Permanent blocker : possibleBlockers) {
        if (attacker.getPower().getValue() < blocker.getToughness().getValue() || attacker.getToughness().getValue() < blocker.getPower().getValue() || attacker.getPower().getValue() >= attackingPlayer.getLife()) {
          if (blocker.getBlocking() == 0) {
            player.declareBlocker(blocker.getId(),attacker.getId(),game);
          }
        }
      }
    }
  }
}
