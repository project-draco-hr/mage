{
  StackObject stackObject=game.getStack().getFirst();
  if (stackObject instanceof StackAbility) {
    SearchEffect effect=getSearchEffect((StackAbility)stackObject);
    if (effect != null && stackObject.getControllerId().equals(playerId)) {
      Target target=effect.getTarget();
      if (!target.doneChosing()) {
        for (        UUID targetId : target.possibleTargets(stackObject.getSourceId(),stackObject.getControllerId(),game)) {
          Game sim=game.copy();
          StackAbility newAbility=(StackAbility)stackObject.copy();
          SearchEffect newEffect=getSearchEffect(newAbility);
          newEffect.getTarget().addTarget(targetId,newAbility,sim);
          sim.getStack().push(newAbility);
          SimulationNode2 newNode=new SimulationNode2(node,sim,depth,stackObject.getControllerId());
          node.children.add(newNode);
          newNode.getTargets().add(targetId);
          logger.trace("Sim search -- node#: " + SimulationNode2.getCount() + " for player: "+ sim.getPlayer(stackObject.getControllerId()).getName());
        }
        return;
      }
    }
  }
  stackObject.resolve(game);
  if (stackObject instanceof StackAbility) {
    game.getStack().remove(stackObject);
  }
  game.applyEffects();
  game.getPlayers().resetPassed();
  game.getPlayerList().setCurrent(game.getActivePlayerId());
}
