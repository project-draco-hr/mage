{
  if (sessionState == SessionState.CONNECTED)   sessionState=SessionState.DISCONNECTING;
  if (future != null && !future.isDone())   future.cancel(true);
  if (connection == null || server == null)   return;
  if (sessionState == SessionState.DISCONNECTING) {
    try {
      server.deregisterClient(sessionId);
    }
 catch (    Exception ex) {
      logger.fatal("Error disconnecting ...",ex);
    }
  }
  server=null;
  if (sessionState == SessionState.DISCONNECTING) {
    sessionState=SessionState.DISCONNECTED;
    logger.info("Disconnected ... ");
  }
  client.disconnected();
  if (showMessage)   client.showError("Server error.  You have been disconnected");
}
