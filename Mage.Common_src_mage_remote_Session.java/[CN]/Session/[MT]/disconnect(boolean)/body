{
  if (sessionState == SessionState.CONNECTED)   sessionState=SessionState.DISCONNECTING;
  cleanupSession();
  if (connection == null)   return;
  if (sessionState == SessionState.CONNECTED) {
    try {
      deregisterClient();
    }
 catch (    Exception ex) {
      logger.fatal("Error disconnecting ...",ex);
    }
  }
  ServerCache.removeServerFromCache(connection);
  client.disconnected();
  logger.info("Disconnected ... ");
  if (sessionState == SessionState.SERVER_UNAVAILABLE && showMessage) {
    client.showError("Server error.  You have been disconnected");
  }
 else {
    sessionState=SessionState.DISCONNECTED;
  }
}
