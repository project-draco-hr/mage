{
  if (!directory.exists())   throw new RuntimeException("File not found " + directory);
  if (!directory.isDirectory())   throw new RuntimeException(directory + " is not a directory");
  File entryPointFile=new File(directory,"entryPoint");
  if (!entryPointFile.exists() || !entryPointFile.isFile())   throw new RuntimeException("Entry point definition not found.");
  File packagesDirectory=new File(directory,"packages");
  if (!packagesDirectory.exists() || !packagesDirectory.isDirectory())   throw new RuntimeException("Packages directory not found.");
  Scanner entryPointReader=new Scanner(entryPointFile);
  String entryPoint=entryPointReader.nextLine().trim();
  entryPointReader.close();
  PluginClassLoader classLoader=new PluginClassLoader();
  for (  File f : packagesDirectory.listFiles())   classLoader.addURL(f.toURI().toURL());
  try {
    return (CustomSetPackage)Class.forName(entryPoint,false,classLoader).newInstance();
  }
 catch (  InstantiationException|IllegalAccessException e) {
    throw new RuntimeException(e);
  }
catch (  ClassNotFoundException e) {
    throw new RuntimeException("Entry point file not found!",e);
  }
catch (  ClassCastException e) {
    throw new RuntimeException("Entry point not an instance of CustomSetPackage.",e);
  }
}
