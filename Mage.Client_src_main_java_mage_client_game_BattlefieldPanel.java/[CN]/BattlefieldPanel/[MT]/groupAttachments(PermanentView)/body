{
  MagePermanent perm=permanents.get(permanent.getId());
  if (perm == null)   return;
  int position=getPosition(perm);
  perm.getLinks().clear();
  Rectangle r=perm.getBounds();
  if (!Plugins.getInstance().isCardPluginLoaded()) {
    for (    UUID attachmentId : permanent.getAttachments()) {
      MagePermanent link=permanents.get(attachmentId);
      if (link != null) {
        perm.getLinks().add(link);
        r.translate(20,20);
        link.setBounds(r);
        setPosition(link,++position);
      }
    }
  }
 else {
    int index=permanent.getAttachments().size();
    for (    UUID attachmentId : permanent.getAttachments()) {
      MagePermanent link=permanents.get(attachmentId);
      if (link != null) {
        link.setBounds(r);
        perm.getLinks().add(link);
        r.translate(8,10);
        perm.setBounds(r);
        moveToFront(link);
        moveToFront(perm);
        jPanel.setComponentZOrder(link,index);
        index--;
      }
    }
    jPanel.setComponentZOrder(perm,index);
  }
}
