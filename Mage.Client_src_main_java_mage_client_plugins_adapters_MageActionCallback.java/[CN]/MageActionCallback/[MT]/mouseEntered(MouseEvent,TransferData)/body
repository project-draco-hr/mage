{
  hidePopup();
  this.popupCard=data.card;
  Component parentComponent=SwingUtilities.getRoot(data.component);
  Point parentPoint=parentComponent.getLocationOnScreen();
  List<UUID> targets=data.card.getTargets();
  if (targets != null) {
    Point me=new Point(data.locationOnScreen);
    me.translate(-parentPoint.x,-parentPoint.y);
    for (    UUID uuid : targets) {
      PlayAreaPanel p=session.getGame(data.gameId).getPlayers().get(uuid);
      if (p != null) {
        Point target=p.getLocationOnScreen();
        target.translate(-parentPoint.x,-parentPoint.y);
        ArrowBuilder.addArrow((int)me.getX() + 35,(int)me.getY(),(int)target.getX() + 40,(int)target.getY() - 40,Color.red);
      }
 else {
        for (        PlayAreaPanel pa : session.getGame(data.gameId).getPlayers().values()) {
          MagePermanent permanent=pa.getBattlefieldPanel().getPermanents().get(uuid);
          if (permanent != null) {
            Point target=permanent.getLocationOnScreen();
            target.translate(-parentPoint.x,-parentPoint.y);
            ArrowBuilder.addArrow((int)me.getX() + 35,(int)me.getY(),(int)target.getX() + 40,(int)target.getY() + 10,Color.red);
          }
        }
      }
    }
  }
  if (data.card.isAbility()) {
    Point me=new Point(data.locationOnScreen);
    me.translate(-parentPoint.x,-parentPoint.y);
    UUID uuid=data.card.getParentId();
    for (    PlayAreaPanel pa : session.getGame(data.gameId).getPlayers().values()) {
      MagePermanent permanent=pa.getBattlefieldPanel().getPermanents().get(uuid);
      if (permanent != null) {
        Point source=permanent.getLocationOnScreen();
        source.translate(-parentPoint.x,-parentPoint.y);
        ArrowBuilder.addArrow((int)source.getX() + 40,(int)source.getY() + 10,(int)me.getX() + 35,(int)me.getY() + 20,Color.blue);
      }
    }
  }
  showPopup(data,parentComponent,parentPoint);
}
