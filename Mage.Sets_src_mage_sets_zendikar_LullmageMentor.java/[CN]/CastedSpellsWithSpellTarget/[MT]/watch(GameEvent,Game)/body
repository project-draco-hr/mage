{
  if (event.getType() == GameEvent.EventType.SPELL_CAST || event.getType() == GameEvent.EventType.ACTIVATED_ABILITY) {
    StackObject stackObject=game.getStack().getStackObject(event.getTargetId());
    if (stackObject != null && stackObject.getStackAbility() != null) {
      for (      Target target : stackObject.getStackAbility().getTargets()) {
        if (target instanceof TargetSpell && target.getFirstTarget() != null) {
          casted.put(getKey(target.getFirstTarget(),stackObject.getSourceId()),stackObject.getControllerId());
        }
      }
    }
  }
}
