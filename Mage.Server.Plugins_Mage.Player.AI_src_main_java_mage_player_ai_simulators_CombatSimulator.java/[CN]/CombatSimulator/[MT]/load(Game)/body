{
  CombatSimulator simCombat=new CombatSimulator();
  for (  CombatGroup group : game.getCombat().getGroups()) {
    simCombat.groups.add(new CombatGroupSimulator(group.getDefenderId(),group.getAttackers(),group.getBlockers(),game));
  }
  for (  UUID defenderId : game.getCombat().getDefenders()) {
    simCombat.defenders.add(defenderId);
    Player player=game.getPlayer(defenderId);
    if (player != null) {
      simCombat.playersLife.put(defenderId,player.getLife());
    }
 else {
      Permanent permanent=game.getPermanent(defenderId);
      simCombat.planeswalkerLoyalty.put(defenderId,permanent.getLoyalty().getValue());
    }
  }
  return simCombat;
}
