{
  if (isEmpty()) {
    this.add(new Mana());
  }
  if (!abilities.isEmpty()) {
    if (abilities.size() == 1) {
      ManaAbility ability=abilities.get(0);
      List<Mana> netManas=abilities.get(0).getNetMana(game);
      if (ability.getManaCosts().isEmpty()) {
        if (netManas.size() == 1) {
          addMana(netManas.get(0));
        }
 else {
          List<Mana> copy=copy();
          this.clear();
          for (          Mana netMana : netManas) {
            for (            Mana mana : copy) {
              Mana newMana=new Mana();
              newMana.add(mana);
              newMana.add(netMana);
              this.add(newMana);
            }
          }
        }
      }
 else {
        if (netManas.size() == 1) {
          subtractCostAddMana(ability.getManaCosts().getMana(),netManas.get(0),ability.getCosts().isEmpty());
        }
 else {
          List<Mana> copy=copy();
          this.clear();
          for (          Mana netMana : netManas) {
            for (            Mana mana : copy) {
              Mana newMana=new Mana();
              newMana.add(mana);
              newMana.add(netMana);
              subtractCostAddMana(ability.getManaCosts().getMana(),netMana,ability.getCosts().isEmpty());
            }
          }
        }
      }
    }
 else     if (abilities.size() > 1) {
      List<Mana> copy=copy();
      this.clear();
      for (      ManaAbility ability : abilities) {
        List<Mana> netManas=ability.getNetMana(game);
        if (ability.getManaCosts().isEmpty()) {
          for (          Mana netMana : netManas) {
            for (            Mana mana : copy) {
              Mana newMana=new Mana();
              newMana.add(mana);
              newMana.add(netMana);
              this.add(newMana);
            }
          }
        }
 else {
          for (          Mana netMana : netManas) {
            for (            Mana mana : copy) {
              Mana newMana=new Mana();
              newMana.add(mana);
              if (mana.includesMana(ability.getManaCosts().getMana())) {
                newMana.subtractCost(ability.getManaCosts().getMana());
                newMana.add(netMana);
                this.add(newMana);
              }
            }
          }
        }
      }
    }
  }
}
