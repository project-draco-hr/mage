{
  BufferedImage backgroundImage;
  try {
    if (PreferencesDialog.getCachedValue(PreferencesDialog.KEY_BATTLEFIELD_IMAGE_DEFAULT,"true").equals("true")) {
      backgroundImage=loadbuffer_default();
    }
 else     if (PreferencesDialog.getCachedValue(PreferencesDialog.KEY_BATTLEFIELD_IMAGE_RANDOM,"true").equals("true")) {
      backgroundImage=loadbuffer_random();
    }
 else     if (PreferencesDialog.getCachedValue(PreferencesDialog.KEY_BATTLEFIELD_IMAGE,"") != null) {
      backgroundImage=loadbuffer_selected();
    }
 else {
      backgroundImage=loadbuffer_default();
    }
    if (backgroundImage == null) {
      backgroundImage=loadbuffer_default();
    }
    if (backgroundImage == null) {
      throw new FileNotFoundException("Couldn't find in resources.");
    }
    if (ui.containsKey("gamePanel") && ui.containsKey("jLayeredPane")) {
      ImagePanel bgPanel=new ImagePanel(backgroundImage,ImagePanel.TILED);
      unsetOpaque(ui.get("jSplitPane1"));
      unsetOpaque(ui.get("pnlBattlefield"));
      unsetOpaque(ui.get("jPanel3"));
      unsetOpaque(ui.get("hand"));
      unsetOpaque(ui.get("gameChatPanel"));
      unsetOpaque(ui.get("userChatPanel"));
      ui.get("gamePanel").remove(ui.get("jLayeredPane"));
      bgPanel.add(ui.get("jLayeredPane"));
      ui.get("gamePanel").add(bgPanel);
    }
 else {
      log.error("error: no components");
    }
  }
 catch (  Exception e) {
    log.error(e.getMessage(),e);
  }
}
