{
  if (allowUndo) {
    setStoredBookmark(game.bookmarkState());
  }
  Permanent attacker=game.getPermanent(attackerId);
  if (attacker != null && attacker.canAttack(defenderId,game) && attacker.getControllerId().equals(playerId)) {
    if (!game.getCombat().declareAttacker(attackerId,defenderId,playerId,game)) {
      game.undo(playerId);
    }
  }
}
