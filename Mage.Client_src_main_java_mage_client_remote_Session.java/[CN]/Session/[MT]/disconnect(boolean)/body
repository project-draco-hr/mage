{
  if (reconnecting)   return;
  if (future != null && !future.isDone())   future.cancel(true);
  frame.setStatusText("Not connected");
  frame.disableButtons();
  server=null;
  if (!voluntary && !connecting) {
    if (attemptReconnect())     return;
  }
  try {
    for (    UUID chatId : chats.keySet()) {
      server.leaveChat(chatId,sessionId);
    }
  }
 catch (  Exception ex) {
  }
  try {
    if (server != null)     server.deregisterClient(sessionId);
  }
 catch (  RemoteException ex) {
    logger.fatal("Error disconnecting ...",ex);
  }
catch (  MageException ex) {
    logger.fatal("Error disconnecting ...",ex);
  }
  frame.hideGames();
  frame.hideTables();
  logger.info("Disconnected ... ");
  if (!voluntary && !connecting)   JOptionPane.showMessageDialog(MageFrame.getDesktop(),"Server error.  You have been disconnected","Error",JOptionPane.ERROR_MESSAGE);
}
