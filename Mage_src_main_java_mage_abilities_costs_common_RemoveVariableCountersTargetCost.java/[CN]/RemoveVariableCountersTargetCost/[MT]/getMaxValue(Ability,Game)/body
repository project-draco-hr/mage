{
  int maxValue=0;
  for (  Permanent permanent : game.getBattlefield().getAllActivePermanents(filter,source.getControllerId(),game)) {
    if (counterTypeToRemove != null) {
      maxValue+=permanent.getCounters(game).getCount(counterTypeToRemove);
    }
 else {
      for (      Counter counter : permanent.getCounters(game).values()) {
        maxValue+=counter.getCount();
      }
    }
  }
  return maxValue;
}
