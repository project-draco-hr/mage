{
  Player player=game.getPlayer(source.getControllerId());
  if (player == null) {
    return false;
  }
  int convertedManaCost=0;
  boolean sacrifice=false;
  TargetControlledPermanent targetArtifact=new TargetControlledPermanent(new FilterControlledArtifactPermanent());
  if (player.chooseTarget(Outcome.Sacrifice,targetArtifact,source,game)) {
    Permanent permanent=game.getPermanent(targetArtifact.getFirstTarget());
    if (permanent != null) {
      convertedManaCost=permanent.getManaCost().convertedManaCost();
      sacrifice=permanent.sacrifice(source.getSourceId(),game);
    }
  }
 else {
    return true;
  }
  if (sacrifice && player.searchLibrary(target,game)) {
    if (target.getTargets().size() > 0) {
      for (      UUID cardId : (List<UUID>)target.getTargets()) {
        Card card=player.getLibrary().getCard(cardId,game);
        if (card != null) {
          if (card.getManaCost().convertedManaCost() <= convertedManaCost) {
            card.putOntoBattlefield(game,Zone.LIBRARY,source.getSourceId(),source.getControllerId(),false);
          }
 else {
            GenericManaCost cost=new GenericManaCost(card.getManaCost().convertedManaCost() - convertedManaCost);
            if (cost.pay(source,game,source.getSourceId(),source.getControllerId(),false)) {
              card.putOntoBattlefield(game,Zone.LIBRARY,source.getSourceId(),source.getControllerId(),false);
            }
 else {
              card.moveToZone(Zone.GRAVEYARD,source.getSourceId(),game,true);
            }
          }
        }
      }
    }
    player.shuffleLibrary(game);
    return true;
  }
  player.shuffleLibrary(game);
  return false;
}
