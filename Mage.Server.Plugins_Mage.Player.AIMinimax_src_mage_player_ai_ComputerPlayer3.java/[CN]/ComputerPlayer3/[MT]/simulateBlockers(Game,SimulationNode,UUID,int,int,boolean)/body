{
  if (Thread.interrupted()) {
    Thread.currentThread().interrupt();
    logger.debug(indent(node.depth) + "interrupted");
    return GameStateEvaluator.evaluate(playerId,game);
  }
  Integer val=null;
  SimulationNode bestNode=null;
  if (game.getCombat().isAttacked(defenderId,game)) {
    SimulatedPlayer defender=(SimulatedPlayer)game.getPlayer(defenderId);
    if (logger.isDebugEnabled())     logger.debug(indent(node.depth) + defender.getName() + "'s possible blockers: "+ defender.getAvailableBlockers(game));
    for (    Combat engagement : defender.addBlockers(game)) {
      if (alpha >= beta) {
        logger.debug(indent(node.depth) + "simulating -- pruning blockers");
        break;
      }
      Game sim=game.copy();
      for (      CombatGroup group : engagement.getGroups()) {
        if (group.getAttackers().size() > 0) {
          UUID attackerId=group.getAttackers().get(0);
          for (          UUID blockerId : group.getBlockers()) {
            sim.getPlayer(defenderId).declareBlocker(blockerId,attackerId,sim);
          }
        }
      }
      sim.fireEvent(GameEvent.getEvent(GameEvent.EventType.DECLARED_BLOCKERS,defenderId,defenderId));
      SimulationNode newNode=new SimulationNode(node,sim,defenderId);
      if (logger.isDebugEnabled())       logger.debug(indent(node.depth) + "simulating block for player:" + game.getPlayer(defenderId).getName());
      sim.checkStateAndTriggered();
      while (!sim.getStack().isEmpty()) {
        sim.getStack().resolve(sim);
        logger.debug(indent(node.depth) + "resolving triggered abilities");
        sim.applyEffects();
      }
      sim.fireEvent(GameEvent.getEvent(GameEvent.EventType.DECLARE_BLOCKERS_STEP_POST,sim.getActivePlayerId(),sim.getActivePlayerId()));
      Combat simCombat=sim.getCombat().copy();
      finishCombat(sim);
      if (sim.isGameOver()) {
        val=GameStateEvaluator.evaluate(playerId,sim);
      }
 else       if (!counter) {
        val=simulatePostCombatMain(sim,newNode,alpha,beta);
      }
 else       val=GameStateEvaluator.evaluate(playerId,sim);
      if (!defenderId.equals(playerId)) {
        if (val < beta) {
          beta=val;
          bestNode=newNode;
          node.setCombat(simCombat);
        }
      }
 else {
        if (val > alpha) {
          alpha=val;
          bestNode=newNode;
          node.setCombat(simCombat);
        }
      }
    }
  }
  if (val == null)   val=GameStateEvaluator.evaluate(playerId,game);
  if (bestNode != null) {
    node.children.clear();
    node.children.add(bestNode);
  }
  if (logger.isDebugEnabled())   logger.debug(indent(node.depth) + "returning -- combat blocker score: " + val+ " depth:"+ node.depth+ " for player:"+ game.getPlayer(node.getPlayerId()).getName());
  return val;
}
