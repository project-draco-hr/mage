{
  TournamentTypeView tournamentType=(TournamentTypeView)cbTournamentType.getSelectedItem();
  TournamentOptions tOptions=new TournamentOptions(this.txtName.getText());
  tOptions.setTournamentType(tournamentType.getName());
  tOptions.setPassword(txtPassword.getText());
  tOptions.getPlayerTypes().add("Human");
  tOptions.setWatchingAllowed(cbAllowSpectators.isSelected());
  for (  TournamentPlayerPanel player : players) {
    tOptions.getPlayerTypes().add((String)player.getPlayerType().getSelectedItem());
  }
  if (!tournamentType.isElimination()) {
    tOptions.setNumberRounds((Integer)spnNumRounds.getValue());
  }
  if (tournamentType.isDraft()) {
    DraftOptions options=new DraftOptions();
    options.setDraftType("");
    options.setTiming((TimingOption)this.cbDraftTiming.getSelectedItem());
    tOptions.setLimitedOptions(options);
  }
  if (tOptions.getLimitedOptions() == null) {
    tOptions.setLimitedOptions(new LimitedOptions());
  }
  if (tournamentType.isLimited()) {
    tOptions.getLimitedOptions().setConstructionTime((Integer)this.spnConstructTime.getValue() * 60);
    if (tournamentType.isCubeBooster()) {
      tOptions.getLimitedOptions().setDraftCubeName(this.cbDraftCube.getSelectedItem().toString());
    }
 else {
      for (      JComboBox pack : packs) {
        tOptions.getLimitedOptions().getSetCodes().add(((ExpansionInfo)pack.getSelectedItem()).getCode());
      }
    }
    tOptions.getMatchOptions().setDeckType("Limited");
    tOptions.getMatchOptions().setGameType("Two Player Duel");
    tOptions.getMatchOptions().setLimited(true);
  }
 else {
    tOptions.getLimitedOptions().setConstructionTime(0);
    tOptions.getLimitedOptions().setNumberBoosters(0);
    tOptions.getLimitedOptions().setDraftCube(null);
    tOptions.getLimitedOptions().setDraftCubeName("");
    tOptions.getMatchOptions().setDeckType((String)this.cbDeckType.getSelectedItem());
    tOptions.getMatchOptions().setGameType(((GameTypeView)this.cbGameType.getSelectedItem()).getName());
    tOptions.getMatchOptions().setLimited(false);
  }
  tOptions.getMatchOptions().setMatchTimeLimit((MatchTimeLimit)this.cbTimeLimit.getSelectedItem());
  tOptions.getMatchOptions().setWinsNeeded((Integer)this.spnNumWins.getValue());
  tOptions.getMatchOptions().setFreeMulligans((Integer)this.spnFreeMulligans.getValue());
  tOptions.getMatchOptions().setAttackOption(MultiplayerAttackOption.LEFT);
  tOptions.getMatchOptions().setRange(RangeOfInfluence.ALL);
  saveTournamentSettingsToPrefs(tOptions);
  table=session.createTournamentTable(roomId,tOptions);
  if (table == null) {
    return;
  }
  if (session.joinTournamentTable(roomId,table.getTableId(),this.player1Panel.getPlayerName(),"Human",1,DeckImporterUtil.importDeck(this.player1Panel.getDeckFile()),tOptions.getPassword())) {
    for (    TournamentPlayerPanel player : players) {
      if (!player.getPlayerType().toString().equals("Human")) {
        if (!player.joinTournamentTable(roomId,table.getTableId(),DeckImporterUtil.importDeck(this.player1Panel.getDeckFile()))) {
          session.removeTable(roomId,table.getTableId());
          table=null;
          return;
        }
      }
    }
    this.hideDialog();
    return;
  }
  JOptionPane.showMessageDialog(MageFrame.getDesktop(),"Error joining tournament.","Error",JOptionPane.ERROR_MESSAGE);
  session.removeTable(roomId,table.getTableId());
  table=null;
}
