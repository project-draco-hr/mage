{
  ArrayList<Class> classes=new ArrayList<Class>();
  File directory=null;
  String fullPath;
  String relPath=packageName.replace('.','/');
  URL resource=ClassLoader.getSystemClassLoader().getResource(relPath);
  if (resource == null) {
    throw new RuntimeException("No resource for " + relPath);
  }
  fullPath=resource.getFile();
  directory=new File(fullPath);
  try {
    String jarPath=fullPath.replaceFirst("[.]jar[!].*",".jar").replaceFirst("file:","").replaceAll("%20"," ");
    JarFile jarFile=new JarFile(jarPath);
    Enumeration<JarEntry> entries=jarFile.entries();
    while (entries.hasMoreElements()) {
      JarEntry entry=entries.nextElement();
      String entryName=entry.getName();
      if (entryName.startsWith(relPath) && entryName.length() > (relPath.length() + "/".length())) {
        String className=entryName.replace('/','.').replace('\\','.').replace(".class","");
        try {
          Class clazz=Class.forName(className);
          if (CardImpl.class.isAssignableFrom(clazz)) {
            classes.add(clazz);
          }
        }
 catch (        ClassNotFoundException e) {
          throw new RuntimeException("ClassNotFoundException loading " + className);
        }
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(packageName + " (" + directory+ ") does not appear to be a valid package",e);
  }
  return classes;
}
